import urllib.request
import subprocess
import json
import time
import os

print("Removing previous version...")
# Delete old main.exe
os.remove("main.exe")

print("Getting latest version...")
url = "https://zb-bot-2.vercel.app/api/data.json"
with urllib.request.urlopen(url) as response:
    data = json.loads(response.read())
    latest_version = data["bot_version"]

print("Downloading latest version...")
# Download new main.exe
url = f"https://zb-bot-2.vercel.app/api/zb-bot-2-{latest_version}-distributable.exe"
file_name = "main.exe"
folder_path = os.path.dirname(os.path.abspath(__file__))
with urllib.request.urlopen(url) as response, open(os.path.join(folder_path, file_name), 'wb') as out_file:
    data = response.read()
    out_file.write(data)

print("Update complete!")
time.sleep(2)
print("Starting latest version...")
# Call new main.exe
subprocess.run(["python", "main.py"], shell=True)
