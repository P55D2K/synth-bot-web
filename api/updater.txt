import os
import sys
import urllib.request

# Get the latest version number from the command line arguments
latest_version = sys.argv[1]

# Download the latest version of main.exe
url = f'https://zb-bot-2.vercel.app/api/bot_version/zb-bot-2-{latest_version}-distributable.exe'
folder_path = os.path.dirname(os.path.abspath(sys.argv[0]))
file_name = 'new_main.exe'
with urllib.request.urlopen(url) as response, open(os.path.join(folder_path, file_name), 'wb') as out_file:
    out_file.write(response.read())

# Rename the old main.exe to a temporary name
old_file_name = 'main.exe'
new_file_name = 'old_main.exe'
os.rename(os.path.join(folder_path, old_file_name), os.path.join(folder_path, new_file_name))

# Rename the downloaded file to main.exe
os.rename(os.path.join(folder_path, file_name), os.path.join(folder_path, old_file_name))

# Start the new version of the application
os.system(os.path.join(folder_path, old_file_name))
