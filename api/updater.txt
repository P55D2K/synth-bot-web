import os
import requests
import urllib.request

# Get the latest version number from data.json
latest_version = requests.get('https://zb-bot-2.vercel.app/api/data.json').json()['bot_version']

# Download the latest version of main.exe
url = f'https://zb-bot-2.vercel.app/api/bot_version/zb-bot-2-{latest_version}-distributable.exe'

# Get the path of the current folder
folder_path = os.path.dirname(os.path.realpath(__file__))

file_name = 'new_main.exe'
with urllib.request.urlopen(url) as response, open(os.path.join(folder_path, file_name), 'wb') as out_file:
    out_file.write(response.read())

# Rename the old main.exe to a temporary name
old_file_name = 'main.exe'
new_file_name = 'old_main.exe'
os.rename(os.path.join(folder_path, old_file_name), os.path.join(folder_path, new_file_name))

# Rename the downloaded file to main.exe
os.rename(os.path.join(folder_path, file_name), os.path.join(folder_path, old_file_name))

# Start the new version of the application
os.system(os.path.join(folder_path, old_file_name))
